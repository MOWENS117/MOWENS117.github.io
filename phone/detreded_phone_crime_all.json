{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Detrended Phone-Related Crimes in London",
    "subtitle": "Showing cyclical patterns with trend removed"
  },
  "data": {
    "url": "https://raw.githubusercontent.com/MOWENS117/MOWENS117.github.io/refs/heads/main/phone/M1045_MonthlyCrimeDashboard_OtherCrimeData_202501.csv"
  },
  "transform": [
    {
      "filter": "(datum['Crime Subtype'] === 'Robbery Mobile phone' || datum['Crime Subtype'] === 'Theft Person - Mobile phone') && datum['Measure'] === 'Offences'"
    },
    {
      "timeUnit": "yearmonth",
      "field": "Month_Year",
      "as": "month"
    },
    {
      "aggregate": [{
        "op": "sum",
        "field": "Count",
        "as": "total_crimes"
      }],
      "groupby": ["month"]
    },
    {
      "window": [
        {
          "op": "mean",
          "field": "total_crimes",
          "as": "mean_crimes"
        }
      ],
      "frame": [-5, 5]
    },
    {
      "calculate": "datum.total_crimes - datum.mean_crimes",
      "as": "detrended_value"
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "rule",
        "color": "#666666",
        "strokeDash": [4, 4]
      },
      "encoding": {
        "y": {"datum": 0}
      }
    },
    {
      "mark": {
        "type": "line",
        "point": true,
        "strokeWidth": 2
      },
      "encoding": {
        "x": {
          "field": "month",
          "type": "temporal",
          "title": "Date",
          "axis": {
            "format": "%b %Y"
          }
        },
        "y": {
          "field": "detrended_value",
          "type": "quantitative",
          "title": "Deviation from Moving Average",
          "axis": {
            "titlePadding": 10
          }
        },
        "tooltip": [
          {
            "field": "month",
            "type": "temporal",
            "title": "Month",
            "format": "%B %Y"
          },
          {
            "field": "total_crimes",
            "type": "quantitative",
            "title": "Original Value"
          },
          {
            "field": "detrended_value",
            "type": "quantitative",
            "title": "Deviation",
            "format": ".1f"
          }
        ]
      }
    }
  ],
  "width": 600,
  "height": 400,
  "config": {
    "view": {
      "stroke": null
    },
    "axis": {
      "grid": false
    },
    "line": {
      "color": "#2171b5"
    },
    "point": {
      "color": "#08519c",
      "filled": true
    }
  }
}
